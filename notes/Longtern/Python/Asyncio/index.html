<!DOCTYPE html>
<html lang="en">



<head>
  
  <meta charset="UTF-8" />
  <meta
    name="description"
    content="Asyncio åœ¨ Asyncio é€™ç¯‡ç°¡ä»‹çš„æ–‡ç« ä¸­ï¼Œæœ‰ä¸€å€‹ç°¡å–®çš„ä¾‹å­å¦‚ä¸‹ã€‚æœ¬æ–‡å°‡é‡å°æ­¤ä¾‹ä»”ç´°æ¢è¨ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  import asyncio async def single_process(cmd): proc = await asyncio."
  />
  <meta property="og:title" content="">
  <meta property="og:description" content="Asyncio åœ¨ Asyncio é€™ç¯‡ç°¡ä»‹çš„æ–‡ç« ä¸­ï¼Œæœ‰ä¸€å€‹ç°¡å–®çš„ä¾‹å­å¦‚ä¸‹ã€‚æœ¬æ–‡å°‡é‡å°æ­¤ä¾‹ä»”ç´°æ¢è¨ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  import asyncio async def single_process(cmd): proc = await asyncio.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://brainynight.github.io/second-brain/icon.png">
  <meta property="og:url" content="https://brainynight.github.io/second-brain/notes/Longtern/Python/Asyncio/">
  <meta property="og:width" content="200">
  <meta property="og:height" content="200">
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="" />
  <meta name="twitter:description" content="Asyncio åœ¨ Asyncio é€™ç¯‡ç°¡ä»‹çš„æ–‡ç« ä¸­ï¼Œæœ‰ä¸€å€‹ç°¡å–®çš„ä¾‹å­å¦‚ä¸‹ã€‚æœ¬æ–‡å°‡é‡å°æ­¤ä¾‹ä»”ç´°æ¢è¨ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  import asyncio async def single_process(cmd): proc = await asyncio." />
  <meta name="twitter:image" content="https://brainynight.github.io/second-brain/icon.png">
  
    
  

  <title>
    ğŸª´ Digital Note
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  
  
  
  
  <link rel="shortcut icon" type="image/png"  href="https://brainynight.github.io/second-brain//icon.png" />
  

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    
    
  
  
  <link href="https://brainynight.github.io/second-brain/styles.7d481813bbe4f502154ba7bb5eb73d2d.min.css" rel="stylesheet" />

  
  <link href="https://brainynight.github.io/second-brain/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css" rel="stylesheet" id="theme-link">

   
  
  
  
  
  <script src="https://brainynight.github.io/second-brain/js/darkmode.ad5fa1629664e806f9e2c4589974fc3d.min.js"></script>
  
  
  
  <script src="https://brainynight.github.io/second-brain/js/util.00639692264b21bc3ee219733d38a8be.min.js"></script>
  
  
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css" as="style"
      onload="this.onload=null;this.rel='stylesheet'"
      integrity="sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"
        integrity="sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx"
        crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js"
        integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR"
        crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js"
        integrity="sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A"
        crossorigin="anonymous"></script>


  
  



  <script src="https://cdn.jsdelivr.net/npm/@floating-ui/core@1.2.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.2.1"></script>
  
  <script defer src="https://brainynight.github.io/second-brain/js/popover.aa9bc99c7c38d3ae9538f218f1416adb.min.js"></script>

  
  
  
  <script defer src="https://brainynight.github.io/second-brain/js/code-title.ce4a43f09239a9efb48fee342e8ef2df.min.js"></script>
  

  
  
  <script defer src="https://brainynight.github.io/second-brain/js/clipboard.2913da76d3cb21c5deaa4bae7da38c9f.min.js"></script>
  

  
  
  <script defer src="https://brainynight.github.io/second-brain/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js"></script>
  

  
   
  <script>
    const SEARCH_ENABLED =  false 
    const LATEX_ENABLED =  true 
    const PRODUCTION =  true 
    const BASE_URL = "https://brainynight.github.io/second-brain/"
    const fetchData = Promise.all([
          fetch("https:\/\/brainynight.github.io\/second-brain\/indices\/linkIndex.a0b3f347ae9c1aab372d2b99a4f357b0.min.json")
            .then(data => data.json())
            .then(data => ({
              index: data.index,
              links: data.links,
            })),
          fetch("https:\/\/brainynight.github.io\/second-brain\/indices\/contentIndex.22d0811d7162975892790ada9d644107.min.json")
            .then(data => data.json()),
        ])
        .then(([{index, links}, content]) => ({
          index,
          links,
          content,
        }))

      const render = () => {
      

      const siteBaseURL = new URL(BASE_URL);
      const pathBase = siteBaseURL.pathname;
      const pathWindow = window.location.pathname;
      const isHome = pathBase == pathWindow;

      addCopyButtons();
      

      addTitleToCodeBlocks();
      

      addCollapsibleCallouts();
      

      
      initPopover(
        "https://brainynight.github.io/second-brain",
         true 
      )
      

      
      const footer = document.getElementById("footer")
      if (footer) {
        const container = document.getElementById("graph-container")
        
        if (!container) return requestAnimationFrame(render)
        
        container.textContent = ""

        const drawGlobal = isHome &&  false ;
        drawGraph(
            "https://brainynight.github.io/second-brain",
            drawGlobal,
            [{"/notes/Project/Effective-C++-Series/Effective-C++-Outline":"#4388cc"}],
            drawGlobal ? {"centerForce":1,"depth":-1,"enableDrag":true,"enableLegend":false,"enableZoom":true,"fontSize":0.5,"linkDistance":1,"opacityScale":3,"repelForce":1,"scale":1.4} : {"centerForce":1,"depth":1,"enableDrag":true,"enableLegend":false,"enableZoom":true,"fontSize":0.6,"linkDistance":1,"opacityScale":3,"repelForce":2,"scale":1.2}
          );

        }
      

      
        var els = document.getElementsByClassName("mermaid");
        if (els.length > 0) {
          import('https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs').then(
            (obj) => {
              
              
              obj.default.init();
            }
          )
        }
      
      
      
      function clickHandler(evt) {
        const target = evt.target 
        const classNames = target.className.split(" ")
        const broken = classNames.includes("broken")
        const internal = classNames.includes("internal-link")
        plausible("Link Click", {
          props: {
            href: target.href,
            broken,
            internal,
            graph: false,
          }
        })
      }

      const links = document.querySelectorAll("a")
      for (link of links) {
        if (link.className.includes("root-title")) {
          link.addEventListener('click', clickHandler, {once: true})
        }
      }
    }

    const init = (doc = document) => {
      
      addCopyButtons();
      

      addTitleToCodeBlocks();
      renderMathInElement(doc.body, {
        delimiters: [
          {left: '$$', right: '$$', display: true},
          {left: '$', right: '$', display: false},
        ],
        macros: {
          'â€™': "'"
        },
        throwOnError : false
      });
      
    };
  </script>
  
  
  <script type="module">
    import { attachSPARouting } from "https:\/\/brainynight.github.io\/second-brain\/js\/router.d6fe6bd821db9ea97f9aeefae814d8e7.min.js"
    attachSPARouting(init, render)
  </script>
  
  
  <script defer data-domain="brainynight.github.io/second-brain" src="https://plausible.io/js/script.js"></script>
  <script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script>
</head>


<body>
<div id="search-container">
  <div id="search-space">
    <input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search"
      placeholder="Search for something..." dir="">
    <div id="results-container">
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js"
  integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin="anonymous" defer></script>

<script defer src="https://brainynight.github.io/second-brain/js/full-text-search.e6e2e0c213187ca0c703d6e2c7a77fcd.min.js"></script>



<div class="singlePage">
    
    <header>
    
    <h1 id="page-title"><a class="root-title" href="https://brainynight.github.io/second-brain/">ğŸª´ Digital Note</a></h1>
    <div class="spacer"></div>
    <div id="search-icon">
      <p>Search</p>
      <svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg>
    </div>
    <div class='darkmode'>
    <input class='toggle' id='darkmode-toggle' type='checkbox' tabindex="-1">
    <label id="toggle-label-light" for='darkmode-toggle' tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35;" xml:space="preserve">
            <title>Light Mode</title>
            <path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z" />
        </svg>
    </label>
    <label id="toggle-label-dark" for='darkmode-toggle' tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'" xml:space="preserve">
            <title>Dark Mode</title>
            <path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z" />
        </svg>
    </label>
</div>
</header>


    <article>
      
      <p class="meta">
        Last updated 
Feb 23, 2024

 
          

      </p>
      <ul class="tags">
          
      </ul>
      

<aside class="mainTOC">
    <details open >
        <summary>Table of Contents</summary>
        <nav id="TableOfContents">
  <ol>
    <li><a href="#asyncio-1">Asyncio</a></li>
    <li><a href="#coroutine">Coroutine</a></li>
    <li><a href="#awaitable-object">Awaitable object</a>
      <ol>
        <li><a href="#coroutine-object">coroutine object</a></li>
        <li><a href="#asynciotask">asyncio.Task</a></li>
      </ol>
    </li>
    <li><a href="#asynciogather">asyncio.gather</a></li>
    <li><a href="#asynciowait">asyncio.wait</a></li>
    <li><a href="#subproccess">Subproccess</a></li>
    <li><a href="#a">A</a></li>
  </ol>
</nav>
    </details>
</aside>


      




















  
  
  
  
  
  
  
  
    
    
      
      
    
    
  
  
  
  






<a href="#asyncio"><h1 id="asyncio"><span class="hanchor" ariaLabel="Anchor"># </span>Asyncio</h1></a>
<p>åœ¨ 
<a href="https://brainynight.github.io/posts/2022-10-23-python-asyncio" rel="noopener">Asyncio</a> é€™ç¯‡ç°¡ä»‹çš„æ–‡ç« ä¸­ï¼Œæœ‰ä¸€å€‹ç°¡å–®çš„ä¾‹å­å¦‚ä¸‹ã€‚æœ¬æ–‡å°‡é‡å°æ­¤ä¾‹ä»”ç´°æ¢è¨ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">asyncio</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">single_process</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">proc</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_subprocess_shell</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">cmd</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">stdout</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">stderr</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">(),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s2">&#34;complete&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s2">&#34;timeout&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">run_all</span><span class="p">(</span><span class="n">cmds</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">lt</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">cmds</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">lt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_process</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">lt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">cmds</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;sleep 1 &amp;&amp; echo hello&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;sleep 1.5&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;echo world&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;sleep 500&#34;</span><span class="p">,</span>        
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_all</span><span class="p">(</span><span class="n">cmds</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><a href="#asyncio-1"><h2 id="asyncio-1"><span class="hanchor" ariaLabel="Anchor"># </span>Asyncio</h2></a>
<p>main page: 
<a href="https://docs.python.org/zh-tw/3/library/asyncio.html" rel="noopener">https://docs.python.org/zh-tw/3/library/asyncio.html</a></p>
<p>æ¥ä¸‹ä¾†åªæœƒä»‹ç´¹ main page ç•¶ä¸­é«˜éš API çš„éƒ¨åˆ†å…§å®¹ã€‚</p>
<ul>
<li>
<a href="https://docs.python.org/zh-tw/3/library/asyncio-runner.html" rel="noopener"><code>asyncio.Runner</code></a>: æ˜¯ä¸€å€‹ context manager (ä½¿ç”¨ <code>with</code> èªå¥)ï¼Œä½¿æˆ‘å€‘ä¸ç”¨ç®¡è³‡æºé—œé–‰æˆ–é‡‹æ”¾çš„å•é¡Œã€‚</li>
<li>
<a href="https://docs.python.org/zh-tw/3/library/asyncio-task.html" rel="noopener">å”ç¨‹èˆ‡ä»»å‹™ (coroutines and tasks)</a>: é€™å…©è€…æ˜¯ high level API ä½¿ç”¨è€…ä¸»è¦æœƒä½¿ç”¨åˆ°çš„é¡åˆ¥ï¼Œå»ºè­°å¯è©³è®€ã€‚</li>
<li>
<a href="https://docs.python.org/zh-tw/3/library/asyncio-dev.html" rel="noopener">Debug mode</a></li>
<li>
<a href="https://docs.python.org/zh-tw/3/library/asyncio-sync.html" rel="noopener">Synchronization Primitives</a>: asyncio æä¾›äº†ä¸€äº›å’Œ threading æ¨¡çµ„ç›¸ä¼¼çš„ç‰©ä»¶ï¼Œåƒæ˜¯ Lock, Semaphoreã€‚ä¸éè¦æ³¨æ„ï¼Œasyncio æ¨¡çµ„çš„å…§å®¹å¤§å¤šéƒ½æ˜¯ non-thread-safe çš„ã€‚</li>
<li>
<a href="https://docs.python.org/zh-tw/3/library/asyncio-api-index.html" rel="noopener">High Level API Index</a></li>
</ul>
<a href="#coroutine"><h2 id="coroutine"><span class="hanchor" ariaLabel="Anchor"># </span>Coroutine</h2></a>
<p>å®˜å°&quot;Coroutine&quot; é€™å€‹è©å½™çš„èªªæ˜ï¼Œæˆ‘ä¸æ‰“ç®—ä»”ç´°è§£é‡‹ã€‚</p>
<p>åœ¨å®˜æ–¹æ–‡ä»¶ä¸­ï¼Œcoroutine å¾ˆåè¦†çš„è¢«æåŠï¼Œæœ‰æ™‚æŒ‡çš„æ˜¯ coroutine object ï¼Œæœ‰æ™‚æ˜¯ coroutine functionã€‚</p>
<ul>
<li>coroutine function: è¢«ä»¥ <code>async def</code> å®£å‘Šçš„ function</li>
<li>coroutine object: å‘¼å« coroutine function æ™‚æ‰€å›å‚³çš„ç‰©ä»¶ã€‚</li>
</ul>
<p>è©³è¦‹ 
<a href="https://peps.python.org/pep-0492/" rel="noopener">PEP 492</a>ã€‚</p>
<blockquote>
<p>å”ç¨‹ coroutine
<a href="https://docs.python.org/3/glossary.html#term-coroutine" rel="noopener">Â¶</a></p>
<p>Coroutines are a more generalized form of subroutines. Subroutines are entered at one point and exited at another point. Coroutines can be entered, exited, and resumed at many different points. They can be implemented with the 
<a href="https://docs.python.org/3/reference/compound_stmts.html#async-def" rel="noopener"><code>async def</code></a> statement. See also 
<a href="https://peps.python.org/pep-0492/" rel="noopener"><strong>PEP 492</strong></a>.</p>
<p>å”ç¨‹å‡½æ•¸ coroutine function</p>
<p>A function which returns a 
<a href="https://docs.python.org/3/glossary.html#term-coroutine" rel="noopener">coroutine</a> object. A coroutine function may be defined with the 
<a href="https://docs.python.org/3/reference/compound_stmts.html#async-def" rel="noopener"><code>async def</code></a> statement, and may contain 
<a href="https://docs.python.org/3/reference/expressions.html#await" rel="noopener"><code>await</code></a>, 
<a href="https://docs.python.org/3/reference/compound_stmts.html#async-for" rel="noopener"><code>async for</code></a>, and 
<a href="https://docs.python.org/3/reference/compound_stmts.html#async-with" rel="noopener"><code>async with</code></a> keywords. These were introduced by 
<a href="https://peps.python.org/pep-0492/" rel="noopener"><strong>PEP 492</strong></a>.</p>
</blockquote>
<p>ä¸€å€‹å”ç¨‹é€šå¸¸é€éå”ç¨‹å‡½æ•¸å–å¾—ï¼Œå¦‚ä¸‹ä¾‹ <code>cfunc</code> function ï¼Œæœƒå›å‚³ä¸€å€‹ coroutine objectã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">asyncio</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">cfunc</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½•ä»¥å¾—çŸ¥? å¦‚æœä½¿ç”¨ ipython é€™é¡çš„äº’å‹• consoleï¼Œç›´æ¥çœ‹ <code>cfunc()</code> ç‰©ä»¶æ˜¯ä»€éº¼æ±è¥¿ï¼Œæœƒçœ‹åˆ°é€™æ¨£çš„å…§å®¹:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">cfunc</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">coroutine</span> <span class="nb">object</span> <span class="n">cfunc</span> <span class="n">at</span> <span class="mh">0x7fe9094b2650</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="n">cfunc</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">coroutine</span><span class="s1">&#39;&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€™è¡¨ç¤ºï¼Œæ­¤ function å›å‚³çš„å…§å®¹æœƒæ˜¯ä¸€å€‹ coroutine object! è¦æ³¨æ„ï¼Œcoroutine object å¿…é ˆä½¿ç”¨ä¸€äº›æ”¯æ´ç•°æ­¥åŸ·è¡Œçš„å‡½å¼/èªæ³•ä¾†æ­£ç¢ºçš„é‹è¡Œï¼Œä¾‹å¦‚ <code>asyncio.run</code>ï¼Œ <code>cfunc()</code> å¯¦è³ªä¸Šçš„åŠŸèƒ½ï¼Œå°±åªæ˜¯å›å‚³ä¸€å€‹ coroutine object è€Œå·²ã€‚</p>
<a href="#awaitable-object"><h2 id="awaitable-object"><span class="hanchor" ariaLabel="Anchor"># </span>Awaitable object</h2></a>
<p>æŒ‡çš„æ˜¯å¯ä»¥ç”¨åœ¨ <code>await</code> expression çš„ç‰©ä»¶ï¼Œä¸»è¦çš„ä¸‰ç¨® awaitable object æ˜¯ coroutines, Tasks, å’Œ Futuresï¼Œå¦å¤–å°±æ˜¯æ“æœ‰ <code>__await__()</code> æ–¹æ³•çš„ç‰©ä»¶ã€‚<code>await</code> åªèƒ½è¢«ä½¿ç”¨åœ¨ coroutine function å…§ã€‚ä¸‰ç¨® type ç•¶ä¸­ï¼ŒFuture å±¬æ–¼æ¯”è¼ƒåº•å±¤çš„ APIï¼Œå°‡ä¸èªªæ˜ã€‚</p>
<a href="#coroutine-object"><h3 id="coroutine-object"><span class="hanchor" ariaLabel="Anchor"># </span>coroutine object</h3></a>
<p>å‰ä¾‹çš„ <code>asyncio.sleep(1)</code> ï¼Œæœ¬è³ªä¸Šä¹Ÿæ˜¯é€éä¸€å€‹ coroutine function å–å¾— coroutine objectï¼Œå› æ­¤å¿…é ˆä»¥é—œéµå­—  <code>await</code> æ¥ä½é€™å€‹ coroutine objectã€‚</p>
<p>è‹¥ coroutine function å…§é‚„æœƒå‘¼å«å¦ä¸€å€‹ coroutine functionï¼Œè¢«å‘¼å«çš„ coroutine function å‰å¿…é ˆåŠ  <code>await</code>ï¼Œå› ç‚ºå®ƒå›å‚³çš„æ˜¯å€‹ coroutine objectã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">asyncio</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">say_after</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">what</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">what</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;started at </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%X</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># needs to add `await` when call a coroutine function, but not directly execute.</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">say_after</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">say_after</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;finished at </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%X</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># The method for directly execute is asyncio.run</span>
</span></span><span class="line"><span class="cl"><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>asyncio.run</code> æ‰æœƒçœŸæ­£åŸ·è¡Œè¢«çµ¦äºˆçš„ coroutine object</li>
</ul>
<a href="#asynciotask"><h3 id="asynciotask"><span class="hanchor" ariaLabel="Anchor"># </span>asyncio.Task</h3></a>
<p><code>create_task</code> å›å‚³ä¸€å€‹ <code>asyncio.Task</code> ç‰©ä»¶ï¼Œæˆ‘å€‘å¾—ä»¥æå‰å‰µé€  taskï¼Œç­‰åˆ°éœ€è¦æƒ³è¦åŸ·è¡Œé€™å€‹ task çš„åœ°æ–¹ï¼Œå†ä»¥ <code>await</code> å‘¼å«ã€‚</p>
<p>åŒæ¨£çš„ï¼Œé€™è£¡çš„ã€ŒåŸ·è¡Œã€ä¸¦ä¸æ˜¯çœŸçš„ã€Œè·‘ã€ä¸‹å»ï¼Œæ¯”è¼ƒåƒæ˜¯æ¨™ç¤ºã€Œæˆ‘æƒ³å†é€™è£¡åŸ·è¡Œé€™å€‹ functionã€ã€‚çœŸæ­£çš„åŸ·è¡Œä¾ç„¶æ˜¯äº¤çµ¦ <code>run</code>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">task1</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">say_after</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">task2</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">say_after</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;started at </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%X</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Wait until both tasks are completed (should take around 2 seconds.)</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">task1</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">task2</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;finished at </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%X</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>
<a href="https://docs.python.org/3/library/asyncio-task.html#asyncio.TaskGroup" rel="noopener"><code>TaskGroup</code></a> æ˜¯å¦å¤–ä¸€ç¨®å‰µå»º task ä¸¦åŸ·è¡Œçš„æ–¹æ³•ï¼Œå¯ä»¥ä¸ç”¨å¯« <code>await</code> (éš±æ€§çš„åœ¨ <code>with</code> çµæŸæ™‚å‘¼å« await æŠŠ tasks call ä¸€é)ï¼Œä¸éé€™å€‹ API åªåœ¨ Python3.11 èµ·æä¾›ï¼Œå°±ä¸å¤šæã€‚</p>
<a href="#asynciogather"><h2 id="asynciogather"><span class="hanchor" ariaLabel="Anchor"># </span>asyncio.gather</h2></a>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">aws</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ¥æ”¶å¤šå€‹ awaitable ç‰©ä»¶ï¼Œå¦‚æœ awaitable ç‰©ä»¶ç•¶ä¸­æœ‰ coroutineï¼Œgather æœƒæŠŠå®ƒç•¶ä½œ Task èª¿åº¦ (scheduled as a <code>Task</code>)ã€‚</li>
<li>å›å‚³å€¼: ç•¶æ‰€æœ‰çš„ awaitable object éƒ½å®Œæˆä»»å‹™å¾Œï¼Œ<code>asyncio.gather</code> æœƒæŠŠé€™äº›ä»»å‹™çš„å›å‚³å€¼æ”¾åœ¨ä¸€å€‹ list è£¡é¢å›å‚³çµæœã€‚çµæœçš„é †åºèˆ‡æ”¾é€² <code>gather</code> çš„é †åºç›¸åŒã€‚</li>
<li><code>return_exception</code>
<ul>
<li>é è¨­æ˜¯ falseï¼Œç•¶ä»»å‹™åŸ·è¡Œä¸­ç™¼ç”Ÿ exceptionï¼ŒæœƒåŠæ™‚ raise exceptionï¼Œä¸¦å–æ¶ˆ gather (å‰©ä¸‹çš„ä»»å‹™å°‡ä¸æœƒè·‘åˆ°)</li>
<li>è‹¥ç‚º trueï¼Œå‰‡ä¸æœƒ raise exceptionï¼Œè€Œæ˜¯å°‡ exception çš„å…§å®¹ (?) ç•¶ä½œåŸ·è¡ŒæˆåŠŸçš„çµæœï¼Œä¸€èµ·åœ¨ <code>gather</code> çš„å›å‚³æ¸…å–®ä¸­ã€‚</li>
</ul>
</li>
</ul>
<a href="#asynciowait"><h2 id="asynciowait"><span class="hanchor" ariaLabel="Anchor"># </span>asyncio.wait</h2></a>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">aws</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">ALL_COMPLETED</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ¥æ”¶ä¸€å€‹ listï¼Œå…§å«å¤šå€‹ awaitable ç‰©ä»¶ã€‚</li>
<li>ç¨‹å¼æœƒåœåœ¨é€™è£¡åŸ·è¡ŒåŒæ™‚æ‰€æœ‰çš„ä»»å‹™</li>
</ul>
<a href="#subproccess"><h2 id="subproccess"><span class="hanchor" ariaLabel="Anchor"># </span>Subproccess</h2></a>
<p>
<a href="https://docs.python.org/zh-tw/3/library/asyncio-subprocess.html" rel="noopener">https://docs.python.org/zh-tw/3/library/asyncio-subprocess.html</a></p>
<a href="#a"><h2 id="a"><span class="hanchor" ariaLabel="Anchor"># </span>A</h2></a>
<p><code>asyncio.create_subprocess_shell</code> æ˜¯ä¸€å€‹ coroutine functionï¼Œå›å‚³çš„æ˜¯ <code>asyncio.subprocess.Process</code> ç‰©ä»¶ã€‚
<a href="https://docs.python.org/zh-tw/3/library/asyncio-subprocess.html#asyncio.create_subprocess_shell" rel="noopener">doc</a></p>


    </article>
    

<hr/>


<div class="page-end" id="footer">
    <div class="backlinks-container">
        <h3>Backlinks</h3>
<ul class="backlinks">
    
    
    
    
    
    
    
    <li>
      No backlinks found
    </li>
    
</ul>

    </div>
    <div>
        <script
  src="https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js"
  integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI="
  crossorigin="anonymous"
></script>
<h3>Interactive Graph</h3>
<div id="graph-container"></div>
<style>
  :root {
    --g-node: var(--secondary);
    --g-node-active: var(--primary);
    --g-node-inactive: var(--visited);
    --g-link: var(--outlinegray);
    --g-link-active: #5a7282;
  }
</style>

<script src="https://brainynight.github.io/second-brain/js/graph.6579af7b10c818dbd2ca038702db0224.js"></script>

    </div>
</div>






<div id="contact_buttons">
    <footer>
        
        
        <p>Made by Judy using <a href="https://github.com/jackyzha0/quartz">Quartz</a>, Â© 2024</p>
        <ul>
            
            <li><a href="https://brainynight.github.io/second-brain/">Home</a></li>
            <li><a href="https://github.com/BRainynight">GitHub</a></li></ul>
    </footer>
</div>


</div>
</body>
</html>
